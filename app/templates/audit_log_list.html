{% extends "base.html" %}

{% block content %}
<section class="page-header">
  <h1>Audit Log</h1>
</section>
<section class="card table-card">
  {% if audit_logs %}
    <div class="table-wrapper">
      <table class="table">
        <thead>
          <tr>
            <th>Date</th>
            <th>IP</th>
            <th>User</th>
            <th>Action</th>
            <th>Details</th>
          </tr>
        </thead>
        <tbody>
          {% for log in audit_logs %}
            <tr>
              <td>{{ log.created_at }}</td>
              <td>{{ log.target_label }}</td>
              <td>{{ log.user }}</td>
              <td>{{ log.action }}</td>
              <td>{{ log.changes }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <div class="table-footer">
      <div class="table-meta">
        {% if pagination.total %}
        Showing {{ pagination.start_index }}-{{ pagination.end_index }} of {{ pagination.total }}
        {% else %}
        No results to display.
        {% endif %}
      </div>
      <div class="table-footer-controls">
        <div class="table-per-page">
          <form method="get" action="/ui/audit-log" class="per-page-form">
            <label class="field field-inline">
              <span>Rows</span>
              <select
                class="select select-minimal"
                name="per-page"
                onchange="this.form.submit()"
              >
                {% for option in [10, 20, 50, 100] %}
                <option value="{{ option }}"{% if pagination.per_page == option %} selected{% endif %}>{{ option }}</option>
                {% endfor %}
              </select>
            </label>
          </form>
        </div>
        {% if pagination.total_pages > 1 %}
        <nav class="pagination" aria-label="Audit log pagination">
          <a
            class="btn btn-secondary btn-small{% if not pagination.has_prev %} btn-disabled{% endif %}"
            href="/ui/audit-log?{{ pagination.base_query }}&page={{ pagination.page - 1 }}"
            {% if not pagination.has_prev %}
            aria-disabled="true"
            tabindex="-1"
            {% endif %}
          >
            Previous
          </a>
          <span class="pagination-status">Page {{ pagination.page }} of {{ pagination.total_pages }}</span>
          <a
            class="btn btn-secondary btn-small{% if not pagination.has_next %} btn-disabled{% endif %}"
            href="/ui/audit-log?{{ pagination.base_query }}&page={{ pagination.page + 1 }}"
            {% if not pagination.has_next %}
            aria-disabled="true"
            tabindex="-1"
            {% endif %}
          >
            Next
          </a>
        </nav>
        {% endif %}
      </div>
    </div>
  {% else %}
    <p>No audit history yet.</p>
  {% endif %}
</section>
<style>
  .table-footer-controls {
    display: flex;
    align-items: center;
    gap: 16px;
  }
  .table-per-page {
    display: flex;
    align-items: center;
  }
  .per-page-form {
    margin: 0;
  }
  .per-page-form .field {
    margin: 0;
    flex-direction: row;
    align-items: center;
    gap: 6px;
  }
  .per-page-form .field span {
    font-size: 12px;
    color: var(--color-muted-light, #64748b);
    font-weight: 400;
  }
  .select-minimal {
    appearance: none;
    background: transparent;
    border: 1px solid #e2e8f0;
    border-radius: 4px;
    padding: 2px 20px 2px 6px;
    font-size: 12px;
    color: #64748b;
    cursor: pointer;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%2364748b' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 4px center;
  }
  .select-minimal:hover {
    border-color: #cbd5e1;
  }
  .select-minimal:focus {
    outline: none;
    border-color: #94a3b8;
  }
</style>
{% endblock %}
