{% extends "base.html" %}

{% block content %}
<section class="page-header">
  <h1>Audit Log</h1>
</section>
<section class="card filter-card">
  <form class="filters-grid" method="get" action="/ui/audit-log" id="audit-log-filters">
    <label class="field">
      <span>Per page</span>
      <select
        class="select"
        name="per-page"
        onchange="document.getElementById('audit-log-filters').submit()"
      >
        {% for option in [10, 20, 50, 100] %}
        <option value="{{ option }}"{% if pagination.per_page == option %} selected{% endif %}>{{ option }}</option>
        {% endfor %}
      </select>
    </label>
  </form>
</section>
<section class="card table-card">
  {% if audit_logs %}
    <div class="table-wrapper">
      <table class="table">
        <thead>
          <tr>
            <th>Date</th>
            <th>IP</th>
            <th>User</th>
            <th>Action</th>
            <th>Details</th>
          </tr>
        </thead>
        <tbody>
          {% for log in audit_logs %}
            <tr>
              <td>{{ log.created_at }}</td>
              <td>{{ log.target_label }}</td>
              <td>{{ log.user }}</td>
              <td>{{ log.action }}</td>
              <td>{{ log.changes }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <div class="table-footer">
      <div class="table-meta">
        {% if pagination.total %}
        Showing {{ pagination.start_index }}-{{ pagination.end_index }} of {{ pagination.total }}
        {% else %}
        No results to display.
        {% endif %}
      </div>
      {% if pagination.total_pages > 1 %}
      <nav class="pagination" aria-label="Audit log pagination">
        <a
          class="btn btn-secondary btn-small{% if not pagination.has_prev %} btn-disabled{% endif %}"
          href="/ui/audit-log?{{ pagination.base_query }}&page={{ pagination.page - 1 }}"
          {% if not pagination.has_prev %}
          aria-disabled="true"
          tabindex="-1"
          {% endif %}
        >
          Previous
        </a>
        <span class="pagination-status">Page {{ pagination.page }} of {{ pagination.total_pages }}</span>
        <a
          class="btn btn-secondary btn-small{% if not pagination.has_next %} btn-disabled{% endif %}"
          href="/ui/audit-log?{{ pagination.base_query }}&page={{ pagination.page + 1 }}"
          {% if not pagination.has_next %}
          aria-disabled="true"
          tabindex="-1"
          {% endif %}
        >
          Next
        </a>
      </nav>
      {% endif %}
    </div>
  {% else %}
    <p>No audit history yet.</p>
  {% endif %}
</section>
{% endblock %}
