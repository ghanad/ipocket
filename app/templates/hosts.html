{% extends "base.html" %}

{% block content %}
<section class="page-header">
  <div>
    <p class="eyebrow">Inventory</p>
    <h1>Hosts</h1>
    <p class="subtitle">Track physical hosts and linked OS/BMC addresses.</p>
  </div>
</section>

<section class="card table-card">
  <div class="table-wrapper">
    <table class="table">
      <thead>
        <tr>
          <th>Host name</th>
          <th>Vendor</th>
          <th>Linked IPs</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% if hosts %}
        {% for host in hosts %}
        <tr>
          <td><a href="/ui/hosts/{{ host.id }}">{{ host.name }}</a></td>
          <td>{{ host.vendor or "" }}</td>
          <td>{{ host.ip_count }}</td>
          <td>
            <button class="btn btn-secondary" type="button" onclick="toggleHostEdit({{ host.id }})">Edit</button>
          </td>
        </tr>
        <tr id="host-edit-row-{{ host.id }}" style="display: none;">
          <td colspan="4">
            <form class="form-grid" method="post" action="/ui/hosts/{{ host.id }}/edit">
              <label class="field">
                <span>Name</span>
                <input class="input" type="text" name="name" value="{{ host.name }}" required />
              </label>
              <label class="field">
                <span>Vendor</span>
                <select class="select" name="vendor_id">
                  <option value="">UNASSIGNED</option>
                  {% for vendor in vendors %}
                  <option value="{{ vendor.id }}"{% if host.vendor and vendor.name == host.vendor %} selected{% endif %}>{{ vendor.name }}</option>
                  {% endfor %}
                </select>
              </label>
              <label class="field">
                <span>Notes</span>
                <textarea class="textarea" name="notes" rows="2">{{ host.notes or "" }}</textarea>
              </label>
              <div class="form-actions">
                <button class="btn btn-primary" type="submit">Save</button>
                <button class="btn btn-secondary" type="button" onclick="toggleHostEdit({{ host.id }})">Cancel</button>
              </div>
            </form>
          </td>
        </tr>
        {% endfor %}
        {% else %}
        <tr><td colspan="4" class="empty-state">No hosts found.</td></tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</section>

{% if errors %}
<div class="alert alert-error">
  <ul>{% for error in errors %}<li>{{ error }}</li>{% endfor %}</ul>
</div>
{% endif %}

<section class="card">
  <h2>Add Host</h2>
  <form class="form-grid" method="post" action="/ui/hosts">
    <label class="field">
      <span>Name</span>
      <input class="input" type="text" name="name" value="{{ form_state.name }}" />
    </label>
    <label class="field">
      <span>Vendor</span>
      <select class="select" name="vendor_id">
        <option value="">UNASSIGNED</option>
        {% for vendor in vendors %}
        <option value="{{ vendor.id }}"{% if form_state.vendor_id == (vendor.id|string) %} selected{% endif %}>{{ vendor.name }}</option>
        {% endfor %}
      </select>
    </label>
    <label class="field">
      <span>Notes</span>
      <textarea class="textarea" name="notes" rows="3">{{ form_state.notes }}</textarea>
    </label>
    <div class="form-actions">
      <button class="btn btn-primary" type="submit">Add Host</button>
    </div>
  </form>
</section>

<script>
function toggleHostEdit(hostId) {
  const row = document.getElementById(`host-edit-row-${hostId}`);
  if (!row) return;
  row.style.display = row.style.display === "none" ? "table-row" : "none";
}
</script>
{% endblock %}
