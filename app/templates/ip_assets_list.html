{% extends "base.html" %}

{% block content %}
<section class="page-header">
  <div>
    <p class="eyebrow">Inventory</p>
    <h1>IP Assets</h1>
    <p class="subtitle">Manage and monitor network address assignments across all zones.</p>
  </div>
  <div class="header-actions">
    <a class="btn btn-primary" href="/ui/ip-assets/new">Add IP</a>
    <a class="btn btn-secondary" href="/ui/ip-assets/needs-assignment">Needs Assignment</a>
  </div>
</section>
<section class="card filter-card">
  <form class="filters-grid" method="get" action="/ui/ip-assets">
    <label class="field">
      <span>Search</span>
      <input class="input" type="text" name="q" value="{{ filters.q }}" placeholder="IP or notes" />
    </label>
    <label class="field">
      <span>Project</span>
      <select class="select" name="project_id">
        <option value="">All</option>
        {% for project in projects %}
        <option value="{{ project.id }}"{% if filters.project_id == project.id %} selected{% endif %}>{{ project.name }}</option>
        {% endfor %}
      </select>
    </label>
    <label class="field">
      <span>Type</span>
      <select class="select" name="type">
        <option value="">All</option>
        {% for asset_type in types %}
        <option value="{{ asset_type }}"{% if filters.type == asset_type %} selected{% endif %}>{{ asset_type }}</option>
        {% endfor %}
      </select>
    </label>
    <label class="checkbox-field">
      <input type="checkbox" name="unassigned-only" value="true"{% if filters.unassigned_only %} checked{% endif %} />
      <span>Unassigned only</span>
    </label>
    <button class="btn btn-outline" type="submit">Apply filters</button>
  </form>
</section>

<section class="card table-card">
  <div class="table-wrapper">
    <table class="table">
      <thead>
        <tr>
          <th>IP address</th>
          <th>Project</th>
          <th>Type</th>
          <th>Notes</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% if assets %}
        {% for asset in assets %}
        <tr>
          <td class="mono"><a href="/ui/ip-assets/{{ asset.id }}">{{ asset.ip_address }}</a></td>
          <td>
            {% if asset.project_unassigned %}
            <span class="tag tag-warning">Unassigned</span>
            {% else %}
            <span class="tag">{{ asset.project_name }}</span>
            {% endif %}
          </td>
          <td class="muted">{{ asset.type }}</td>
          <td class="muted">{{ asset.notes }}</td>
          <td class="asset-actions-cell">
            <details class="row-actions-menu">
              <summary class="row-actions-trigger" aria-label="Open actions for {{ asset.ip_address }}">
                <span aria-hidden="true">‚ãÆ</span>
              </summary>
              <div class="row-actions-panel" role="menu" aria-label="Actions for {{ asset.ip_address }}">
                <a class="row-action-item" role="menuitem" href="/ui/ip-assets/{{ asset.id }}/edit">
                  <span aria-hidden="true">‚úèÔ∏è</span>
                  <span>Edit</span>
                </a>
                <button
                  class="row-action-item row-action-item-danger"
                  type="button"
                  role="menuitem"
                  data-delete-dialog-id="delete-ip-{{ asset.id }}"
                >
                  <span aria-hidden="true">üóëÔ∏è</span>
                  <span>Delete</span>
                </button>
              </div>
            </details>

            <dialog class="delete-confirm-dialog" id="delete-ip-{{ asset.id }}">
              <form method="dialog" class="delete-confirm-dialog-card">
                <h2>Delete IP asset?</h2>
                <p>
                  <strong>{{ asset.ip_address }}</strong> will be removed permanently. You can review details on the
                  confirmation page before deletion.
                </p>
                <div class="delete-confirm-dialog-actions">
                  <button type="button" class="btn btn-secondary" data-close-delete-dialog>Cancel</button>
                  <a class="btn btn-danger" href="/ui/ip-assets/{{ asset.id }}/delete">Continue to delete</a>
                </div>
              </form>
            </dialog>
          </td>
        </tr>
        {% endfor %}
        {% else %}
        <tr>
          <td colspan="7" class="empty-state">No IP assets found.</td>
        </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</section>

<script>
  (() => {
    const openButtons = document.querySelectorAll('[data-delete-dialog-id]');
    openButtons.forEach((button) => {
      button.addEventListener('click', () => {
        const dialog = document.getElementById(button.dataset.deleteDialogId);
        if (dialog && typeof dialog.showModal === 'function') {
          dialog.showModal();
        }
      });
    });

    const closeButtons = document.querySelectorAll('[data-close-delete-dialog]');
    closeButtons.forEach((button) => {
      button.addEventListener('click', () => {
        const dialog = button.closest('dialog');
        if (dialog) {
          dialog.close();
        }
      });
    });
  })();
</script>
{% endblock %}
