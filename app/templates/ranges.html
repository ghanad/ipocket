{% extends "base.html" %}

{% block content %}
<section class="page-header">
  <div>
    <h1>IP Ranges</h1>
    <p class="page-subtitle">Define CIDR ranges and review utilization across active IP assets.</p>
  </div>
</section>

{% if errors %}
  <div class="alert alert-error">
    <ul>
      {% for error in errors %}
      <li>{{ error }}</li>
      {% endfor %}
    </ul>
  </div>
{% endif %}

<section class="card">
  <header class="card-header">
    <h2>Add IP Range</h2>
  </header>
  <form method="post" action="/ui/ranges" class="form-grid">
    <label class="form-field">
      <span>Name</span>
      <input type="text" name="name" value="{{ form_state.name }}" required />
    </label>
    <label class="form-field">
      <span>CIDR</span>
      <input type="text" name="cidr" value="{{ form_state.cidr }}" placeholder="192.168.10.0/24" required />
    </label>
    <label class="form-field form-field-full">
      <span>Notes</span>
      <textarea name="notes" rows="2">{{ form_state.notes }}</textarea>
    </label>
    <div class="form-actions">
      <button type="submit" class="button button-primary">Save range</button>
    </div>
  </form>
</section>

<section class="card">
  <header class="card-header">
    <h2>Subnet Utilization</h2>
  </header>
  <div class="table-wrapper">
    <table class="table">
      <thead>
        <tr>
          <th>Name</th>
          <th>CIDR</th>
          <th>Total usable</th>
          <th>Used</th>
          <th>Free</th>
          <th>Utilization</th>
        </tr>
      </thead>
      <tbody>
        {% for row in utilization %}
        <tr>
          <td>{{ row.name }}</td>
          <td>{{ row.cidr }}</td>
          <td>{{ row.total_usable }}</td>
          <td>{{ row.used }}</td>
          <td>{{ row.free }}</td>
          <td>{{ "%.1f"|format(row.utilization_percent) }}%</td>
        </tr>
        {% else %}
        <tr>
          <td colspan="6" class="empty-state">No ranges yet. Add one above to see utilization.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>

<section class="card">
  <header class="card-header">
    <h2>Saved ranges</h2>
  </header>
  <div class="table-wrapper">
    <table class="table">
      <thead>
        <tr>
          <th>Name</th>
          <th>CIDR</th>
          <th>Notes</th>
          <th>Created</th>
        </tr>
      </thead>
      <tbody>
        {% for ip_range in ranges %}
        <tr>
          <td>{{ ip_range.name }}</td>
          <td>{{ ip_range.cidr }}</td>
          <td>{{ ip_range.notes or "â€”" }}</td>
          <td>{{ ip_range.created_at }}</td>
        </tr>
        {% else %}
        <tr>
          <td colspan="4" class="empty-state">No ranges saved yet.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>
{% endblock %}
