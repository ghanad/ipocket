{% extends "base.html" %}

{% block content %}
<section class="page-header">
  <div>
    <p class="eyebrow">Library</p>
    <h1>Tags</h1>
    <p class="subtitle">Create tags first, then assign them to IP assets.</p>
  </div>
</section>

<section class="card">
  <div class="card-header">
    <div>
      <h2>Create tag</h2>
      <p class="subtitle">Add tags with a color for quick visual grouping.</p>
    </div>
  </div>
  {% if errors %}
  <div class="alert alert-error">
    <p class="alert-title">Fix the following:</p>
    <ul>
      {% for error in errors %}
      <li>{{ error }}</li>
      {% endfor %}
    </ul>
  </div>
  {% endif %}
  <form method="post" action="/ui/tags" class="form-grid form-grid-two">
    <label class="field">
      <span>Name</span>
      <input class="input" type="text" name="name" value="{{ form_state.name }}" required />
    </label>
    <label class="field">
      <span>Color</span>
      <input class="input input-color" type="color" name="color" value="{{ form_state.color }}" />
    </label>
    <div class="form-actions">
      <button class="btn btn-primary" type="submit">Create tag</button>
    </div>
  </form>
</section>

<section class="card table-card tags-existing-card">
  <div class="card-header">
    <div>
      <h2>Existing tags</h2>
      <p class="subtitle">Edit, recolor, or remove tags as needed.</p>
    </div>
  </div>
  <div class="table-wrapper">
    <table class="table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Color</th>
          <th>Preview</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% if tags %}
        {% for tag in tags %}
        <tr>
          <td>
            <input class="input" type="text" name="name" value="{{ tag.name }}" form="edit-tag-{{ tag.id }}" required />
          </td>
          <td>
            <input class="input input-color" type="color" name="color" value="{{ tag.color }}" form="edit-tag-{{ tag.id }}" />
          </td>
          <td>
            <span class="tag tag-color" style="--tag-color: {{ tag.color }}">{{ tag.name }}</span>
          </td>
          <td class="asset-actions-cell">
            <div class="row-actions-menu" data-row-actions>
              <button
                class="row-actions-trigger"
                type="button"
                aria-label="Open actions for {{ tag.name }}"
                aria-expanded="false"
                aria-haspopup="true"
                aria-controls="row-actions-tag-{{ tag.id }}"
                data-row-actions-toggle
              >
                <span class="row-actions-icon" aria-hidden="true">‚ãÆ</span>
              </button>
              <div
                class="row-actions-panel"
                id="row-actions-tag-{{ tag.id }}"
                role="menu"
                aria-label="Actions for {{ tag.name }}"
                data-row-actions-panel
                hidden
              >
                <form id="edit-tag-{{ tag.id }}" method="post" action="/ui/tags/{{ tag.id }}/edit" class="inline-edit-form">
                  <button class="row-action-item" type="submit" role="menuitem">
                    <span aria-hidden="true">‚úèÔ∏è</span>
                    <span>Save</span>
                  </button>
                </form>
                <form
                  method="post"
                  action="/ui/tags/{{ tag.id }}/delete"
                  class="inline-edit-form"
                  data-tag-delete-form
                  data-tag-name="{{ tag.name }}"
                >
                  <button class="row-action-item row-action-item-danger" type="submit" role="menuitem">
                    <span aria-hidden="true">üóëÔ∏è</span>
                    <span>Delete</span>
                  </button>
                </form>
              </div>
            </div>
          </td>
        </tr>
        {% endfor %}
        {% else %}
        <tr>
          <td colspan="4" class="empty-state">No tags yet.</td>
        </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</section>
<script src="/static/js/tags.js" defer></script>
{% endblock %}
